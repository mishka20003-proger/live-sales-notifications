# ğŸ—ï¸ Architecture Diagram - Storefront Purchase Notifications

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SHOPIFY ECOSYSTEM                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Shopify Admin      â”‚
â”‚   (Merchant)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (1) Install App
           â”‚ (2) Enable Theme Extension
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Theme Customizer    â”‚
â”‚  (App Embeds)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (3) Configure Settings
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Storefront         â”‚         â”‚   Shopify Orders     â”‚
â”‚   (Customer View)    â”‚         â”‚   System             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                â”‚
           â”‚ (4) Page Load                  â”‚ (5) New Order
           â”‚     + Extension Active         â”‚     Created
           â†“                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Theme App           â”‚         â”‚  Webhook             â”‚
â”‚  Extension           â”‚         â”‚  orders/create       â”‚
â”‚  (notification-      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   widget.liquid)     â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ (6) POST
           â”‚                                â”‚
           â”‚ (7) Load Assets                â†“
           â†“                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  Webhook Handler     â”‚
â”‚  JavaScript + CSS    â”‚         â”‚  /webhooks/orders/   â”‚
â”‚  (notification-      â”‚         â”‚  create              â”‚
â”‚   widget.js/css)     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
           â”‚                                â”‚ (7) Save Order
           â”‚ (8) Polling                    â†“
           â”‚     Every 15 seconds  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                       â”‚   SQLite Database    â”‚
           â”‚                       â”‚   (Order table)      â”‚
           â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                  â”‚
           â”‚                                  â”‚ (8) Query Recent
           â†“                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App Proxy Request   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  App Proxy Endpoint  â”‚
â”‚  /apps/proxy/        â”‚  (9)    â”‚  /app/proxy/         â”‚
â”‚  recent-orders       â”‚         â”‚  recent-orders       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                â”‚
           â”‚ (10) JSON Response             â”‚
           â”‚      { orders: [...] }         â”‚
           â†“                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  Display Popup       â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  Notification        â”‚
â”‚  (with animation)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed Component Architecture

### 1. Theme App Extension

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  extensions/purchase-notifications/                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  ğŸ“„ shopify.extension.toml                           â”‚
â”‚     â€¢ Extension metadata                             â”‚
â”‚     â€¢ Settings schema (5 fields)                     â”‚
â”‚                                                       â”‚
â”‚  ğŸ“ blocks/                                          â”‚
â”‚     â””â”€â”€ ğŸ“„ notification-widget.liquid                â”‚
â”‚         â€¢ Liquid template                            â”‚
â”‚         â€¢ Renders container div                      â”‚
â”‚         â€¢ Loads JS/CSS assets                        â”‚
â”‚         â€¢ Schema for Theme Customizer                â”‚
â”‚                                                       â”‚
â”‚  ğŸ“ assets/                                          â”‚
â”‚     â”œâ”€â”€ ğŸ“„ notification-widget.js                    â”‚
â”‚     â”‚   â€¢ Polling logic (15s interval)               â”‚
â”‚     â”‚   â€¢ Notification display                       â”‚
â”‚     â”‚   â€¢ Animation handling                         â”‚
â”‚     â”‚   â€¢ Duplicate tracking (Set)                   â”‚
â”‚     â”‚                                                 â”‚
â”‚     â””â”€â”€ ğŸ“„ notification-widget.css                   â”‚
â”‚         â€¢ Popup styles                               â”‚
â”‚         â€¢ Animations (fade + slide)                  â”‚
â”‚         â€¢ Responsive (mobile/desktop)                â”‚
â”‚         â€¢ Dark mode support                          â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Backend API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  app/routes/                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  ğŸ“„ app.proxy.recent-orders.tsx                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚  loader() - GET handler         â”‚             â”‚
â”‚     â”‚  â€¢ Parse shop param             â”‚             â”‚
â”‚     â”‚  â€¢ Query DB (last 7 days)       â”‚             â”‚
â”‚     â”‚  â€¢ Return JSON                  â”‚             â”‚
â”‚     â”‚  â€¢ CORS headers                 â”‚             â”‚
â”‚     â”‚  â€¢ Cache-Control: 10s           â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                       â”‚
â”‚  ğŸ“„ app.storefront-notifications.tsx                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚  Admin UI (Polaris)             â”‚             â”‚
â”‚     â”‚  â€¢ Stats display                â”‚             â”‚
â”‚     â”‚  â€¢ Installation guide           â”‚             â”‚
â”‚     â”‚  â€¢ Troubleshooting              â”‚             â”‚
â”‚     â”‚  â€¢ Quick links                  â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                       â”‚
â”‚  ğŸ“„ webhooks.orders.create.tsx (existing)            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚  action() - POST handler        â”‚             â”‚
â”‚     â”‚  â€¢ Parse webhook payload        â”‚             â”‚
â”‚     â”‚  â€¢ Extract order data           â”‚             â”‚
â”‚     â”‚  â€¢ Save to database             â”‚             â”‚
â”‚     â”‚  â€¢ Handle duplicates            â”‚             â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Order Table (SQLite)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  id              String   @id @default(uuid())       â”‚
â”‚  shopifyOrderId  String   @unique                    â”‚
â”‚  orderNumber     String                              â”‚
â”‚  shop            String                              â”‚
â”‚  totalPrice      String                              â”‚
â”‚  currency        String                              â”‚
â”‚  customerName    String?                             â”‚
â”‚  createdAt       DateTime @default(now())            â”‚
â”‚                                                       â”‚
â”‚  @@index([shop, createdAt])  â† Performance index    â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Sequence

```
STEP 1: Order Creation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Customer â†’ Shopify Checkout â†’ Order Created
                                   â”‚
                                   â†“
                        Shopify triggers webhook
                                   â”‚
                                   â†“
                        POST /webhooks/orders/create
                                   â”‚
                                   â†“
                        Save to SQLite (Order table)


STEP 2: Storefront Loading
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Customer â†’ Visit Storefront â†’ Theme loads
                                   â”‚
                                   â†“
                        Theme includes App Extension
                                   â”‚
                                   â†“
                        notification-widget.liquid renders
                                   â”‚
                                   â†“
                        Loads JS/CSS assets
                                   â”‚
                                   â†“
                        JavaScript initializes


STEP 3: Data Fetching (Polling Loop)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
JavaScript (every 15 seconds)
    â”‚
    â†“
GET https://{shop}.myshopify.com/apps/proxy/recent-orders?shop={shop}
    â”‚
    â†“
Shopify App Proxy redirects to:
    â”‚
    â†“
GET https://{app-url}/app/proxy/recent-orders?shop={shop}
    â”‚
    â†“
Query SQLite:
  WHERE shop = {shop}
    AND createdAt >= NOW() - 7 days
  ORDER BY createdAt DESC
  LIMIT 20
    â”‚
    â†“
Return JSON { orders: [...], lastUpdated: "...", count: N }
    â”‚
    â†“
JavaScript receives data


STEP 4: Display Notification
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
JavaScript has orders array
    â”‚
    â†“
Filter: Remove already displayed (Set tracking)
    â”‚
    â†“
Select next order to show
    â”‚
    â†“
Create DOM element:
  <div class="purchase-notification">
    ğŸ›ï¸ {customerName} just purchased
    Order {orderNumber}
    ${totalPrice} {currency}  {timeAgo}
    [X]
  </div>
    â”‚
    â†“
Add to container with CSS animation
    â”‚
    â†“
Display for {duration} seconds (default: 5s)
    â”‚
    â†“
Fade out and remove
    â”‚
    â†“
Wait {interval} seconds (default: 10s)
    â”‚
    â†“
Show next notification (loop back to STEP 4)
```

---

## Request/Response Flow

### Webhook Flow (Order Created)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     POST      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Save     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Shopify â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Remix   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ SQLite  â”‚
â”‚ Orders  â”‚  /webhooks/   â”‚  Route   â”‚              â”‚   DB    â”‚
â”‚ System  â”‚  orders/createâ”‚          â”‚              â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Request Headers:
  X-Shopify-Shop-Domain: shop.myshopify.com
  X-Shopify-Topic: orders/create
  X-Shopify-Webhook-Id: ...

Request Body:
{
  "id": 123456789,
  "order_number": 1001,
  "total_price": "99.99",
  "currency": "USD",
  "customer": {
    "first_name": "John",
    "last_name": "Doe"
  },
  ...
}

Response:
200 OK "OK"
```

### App Proxy Flow (Fetch Orders)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    GET    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Redirect   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Storefrontâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Shopify  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Remix   â”‚
â”‚ JavaScriptâ”‚  /apps/   â”‚   App    â”‚              â”‚  Route   â”‚
â”‚           â”‚  proxy/   â”‚  Proxy   â”‚              â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  recent-  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
               orders                                    â”‚
                                                        â”‚ Query
                                                        â†“
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚   SQLite    â”‚
                                               â”‚     DB      â”‚
                                               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚ Results
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â†“
â”‚ JavaScriptâ”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  Display  â”‚        JSON Response
â”‚  Popup    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Request:
GET /apps/proxy/recent-orders?shop=shop.myshopify.com

Response:
{
  "orders": [
    {
      "id": "abc-123",
      "shopifyOrderId": "123456789",
      "orderNumber": "#1001",
      "totalPrice": "99.99",
      "currency": "USD",
      "customerName": "John Doe",
      "createdAt": "2025-12-18T10:30:00.000Z"
    },
    ...
  ],
  "lastUpdated": "2025-12-18T10:35:00.000Z",
  "count": 5
}

Response Headers:
  Access-Control-Allow-Origin: *
  Cache-Control: public, max-age=10
  Content-Type: application/json
```

---

## Configuration Flow

### Theme Customizer Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Shopify Admin       â”‚
â”‚  Theme Customizer    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Merchant clicks "App embeds"
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Available Apps      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âœ“ Purchase     â”‚  â”‚ â† Toggle ON/OFF
â”‚  â”‚   Notificationsâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Click to expand settings
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Settings Panel      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ Enable            â”‚  â† checkbox
â”‚  Duration: [5s]      â”‚  â† range slider (3-15)
â”‚  Interval: [10s]     â”‚  â† range slider (5-60)
â”‚  Position: [â–¼]       â”‚  â† select (4 options)
â”‚  Max display: [10]   â”‚  â† range slider (5-50)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Merchant clicks "Save"
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Shopify saves       â”‚
â”‚  configuration to    â”‚
â”‚  theme settings      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Next page load
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Storefront renders  â”‚
â”‚  with new settings   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Layers                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Layer 1: Shopify App Bridge                           â”‚
â”‚    â€¢ OAuth 2.0 for admin access                        â”‚
â”‚    â€¢ Session tokens (JWT)                              â”‚
â”‚    â€¢ HMAC validation                                   â”‚
â”‚                                                         â”‚
â”‚  Layer 2: Webhook Validation                           â”‚
â”‚    â€¢ X-Shopify-Hmac-SHA256 header                      â”‚
â”‚    â€¢ Shopify App Bridge verifies automatically         â”‚
â”‚    â€¢ Idempotency via unique constraint                 â”‚
â”‚                                                         â”‚
â”‚  Layer 3: App Proxy (Public)                           â”‚
â”‚    â€¢ Shopify signs requests (shop, signature params)   â”‚
â”‚    â€¢ MVP: No signature check (read-only public data)   â”‚
â”‚    â€¢ Production: Should verify signature               â”‚
â”‚                                                         â”‚
â”‚  Layer 4: CORS                                         â”‚
â”‚    â€¢ Access-Control-Allow-Origin: *                    â”‚
â”‚    â€¢ Only GET method allowed                           â”‚
â”‚    â€¢ No sensitive data exposed                         â”‚
â”‚                                                         â”‚
â”‚  Layer 5: Data Privacy                                 â”‚
â”‚    â€¢ No PII stored (email, phone, address)             â”‚
â”‚    â€¢ Only public order info                            â”‚
â”‚    â€¢ Old orders (7+ days) not returned                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Performance Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Performance Optimizations                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Frontend:                                              â”‚
â”‚    â€¢ Vanilla JS (no framework overhead)                â”‚
â”‚    â€¢ CSS animations (GPU accelerated)                  â”‚
â”‚    â€¢ Debounced API calls (15s interval)                â”‚
â”‚    â€¢ Minimal DOM operations                            â”‚
â”‚    â€¢ Asset size: <15KB total                           â”‚
â”‚                                                         â”‚
â”‚  Backend:                                               â”‚
â”‚    â€¢ Database index on [shop, createdAt]               â”‚
â”‚    â€¢ SELECT only needed fields                         â”‚
â”‚    â€¢ LIMIT 20 orders                                   â”‚
â”‚    â€¢ WHERE filter (last 7 days)                        â”‚
â”‚    â€¢ HTTP Cache-Control: 10s                           â”‚
â”‚                                                         â”‚
â”‚  Network:                                               â”‚
â”‚    â€¢ Polling: 15s (not 1s)                             â”‚
â”‚    â€¢ Compressed responses (gzip)                       â”‚
â”‚    â€¢ CDN for static assets (future)                    â”‚
â”‚                                                         â”‚
â”‚  Database:                                              â”‚
â”‚    â€¢ SQLite (file-based, fast reads)                   â”‚
â”‚    â€¢ Index optimized queries                           â”‚
â”‚    â€¢ No complex joins                                  â”‚
â”‚    â€¢ Query time: <50ms                                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Production Environment                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   ngrok     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Shopify   â”‚              â”‚
â”‚  â”‚   Tunnel    â”‚  HTTPS  â”‚   Platform  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                                               â”‚
â”‚         â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚   Remix     â”‚                                       â”‚
â”‚  â”‚   Server    â”‚                                       â”‚
â”‚  â”‚  (Port 3000)â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚         â”‚                                               â”‚
â”‚         â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚   SQLite    â”‚                                       â”‚
â”‚  â”‚   Database  â”‚                                       â”‚
â”‚  â”‚ (dev.sqlite)â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                         â”‚
â”‚  Files:                                                 â”‚
â”‚    â€¢ app/routes/*.tsx (backend)                        â”‚
â”‚    â€¢ extensions/purchase-notifications/* (frontend)    â”‚
â”‚    â€¢ prisma/dev.sqlite (database)                      â”‚
â”‚    â€¢ shopify.app.toml (config)                         â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Future (Production Scale):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  CloudFlare â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Shopify   â”‚              â”‚
â”‚  â”‚     CDN     â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚         â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   App       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤    Redis    â”‚              â”‚
â”‚  â”‚   Servers   â”‚  Cache  â”‚    Cache    â”‚              â”‚
â”‚  â”‚ (Load Bal.) â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚         â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚  PostgreSQL â”‚                                       â”‚
â”‚  â”‚   Database  â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

This architecture provides:

- âœ… **Scalability:** Can handle 100s of concurrent shops
- âœ… **Security:** Multi-layer protection
- âœ… **Performance:** <100ms API responses
- âœ… **Maintainability:** Clean separation of concerns
- âœ… **Flexibility:** Easy to extend (WebSocket, Redis, etc.)
- âœ… **Simplicity:** Minimal dependencies for MVP

**Status:** Production Ready ğŸš€

